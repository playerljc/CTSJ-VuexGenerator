{"version":3,"file":"vuexgenerator.js","sources":["vuexgenerator.js"],"sourcesContent":["\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __rest = (this && this.__rest) || function (s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.cleanMixin = exports.mapMutations = exports.mapActions = exports.mapState = void 0;\r\nvar vuex_1 = require(\"vuex\");\r\n// @ts-ignore\r\nvar $store;\r\nvar $serviceConfig;\r\nvar $modules;\r\n/**\r\n * createActions\r\n * @param namespace\r\n * @param service\r\n * @param serviceKeys\r\n */\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nfunction createActions(_a) {\r\n    var namespace = _a.namespace, service = _a.service, serviceKeys = _a.serviceKeys;\r\n    var actions = {};\r\n    var _loop_1 = function (i) {\r\n        var key = serviceKeys[i];\r\n        // eslint-disable-next-line no-continue\r\n        if (key === 'default')\r\n            return \"continue\";\r\n        /**\r\n         * action\r\n         * @param context\r\n         * @param params\r\n         */\r\n        actions[key] = function (_a, params) {\r\n            var commit = _a.commit, state = _a.state;\r\n            return new Promise(function (resolve, reject) {\r\n                // 设置loading为true\r\n                commit('loading/receive', { key: namespace + \"/\" + key, value: true }, { root: true });\r\n                service[key]\r\n                    .call(params)\r\n                    .then(function (response) {\r\n                    var _a;\r\n                    var _b = service.default, codeKey = _b.codeKey, codeSuccessKey = _b.codeSuccessKey, dataKey = _b.dataKey;\r\n                    if (response[codeKey] === codeSuccessKey) {\r\n                        // 向数据流里放入Service的方法名为key,response[dataKey]为值的数据\r\n                        commit('receive', __assign(__assign({}, state), (_a = {}, _a[key] = response[dataKey], _a)));\r\n                        // 更新loading为false\r\n                        commit('loading/receive', { key: namespace + \"/\" + key, value: false }, { root: true });\r\n                        resolve(response);\r\n                    }\r\n                })\r\n                    .catch(function (response) {\r\n                    reject(response);\r\n                });\r\n            });\r\n        };\r\n    };\r\n    for (var i = 0; i < serviceKeys.length; i++) {\r\n        _loop_1(i);\r\n    }\r\n    return actions;\r\n}\r\n/**\r\n * registerLoading\r\n */\r\nfunction registerLoading() {\r\n    // state\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    var _state = {\r\n        global: false,\r\n    };\r\n    // service的属性\r\n    var namespaces = Object.keys($modules);\r\n    var _loop_2 = function (i) {\r\n        // _state[namespaces[i]] = false;\r\n        var namespace = namespaces[i];\r\n        // service的实例\r\n        var Service = $serviceConfig[namespace];\r\n        var serviceKeys = Object.keys(Service);\r\n        serviceKeys.forEach(function (key) {\r\n            if (key !== 'default') {\r\n                _state[namespace + \"/\" + key] = false;\r\n            }\r\n        });\r\n    };\r\n    for (var i = 0; i < namespaces.length; i++) {\r\n        _loop_2(i);\r\n    }\r\n    // 动态注册loading模块\r\n    $store.registerModule('loading', {\r\n        // 开启命名空间\r\n        namespaced: true,\r\n        // @ts-ignore\r\n        state: _state,\r\n        mutations: {\r\n            receive: function (state, _a) {\r\n                var key = _a.key, value = _a.value;\r\n                // eslint-disable-next-line no-param-reassign\r\n                state[key] = value;\r\n                var global = state.global, others = __rest(state, [\"global\"]);\r\n                var globalLoading = false;\r\n                var props = Object.keys(others);\r\n                for (var i = 0; i < props.length; i++) {\r\n                    var prop = props[i];\r\n                    if (others[prop]) {\r\n                        globalLoading = true;\r\n                        break;\r\n                    }\r\n                }\r\n                // eslint-disable-next-line no-param-reassign\r\n                state.global = globalLoading;\r\n                // console.log('key', key);\r\n                // console.log('value', value);\r\n                // console.log('globalLoading', globalLoading);\r\n                // console.log('state', state);\r\n            },\r\n        },\r\n    });\r\n}\r\n/**\r\n * registerBusinessModules\r\n */\r\nfunction registerBusinessModules() {\r\n    // 获取所有模块的命名空间\r\n    var namespaces = Object.keys($modules);\r\n    var _loop_3 = function (i) {\r\n        // 命名空间\r\n        var namespace = namespaces[i];\r\n        // module的缺省对象\r\n        var module_1 = $modules[namespace];\r\n        // service的实例\r\n        var Service = $serviceConfig[namespace];\r\n        var serviceKeys = Object.keys(Service);\r\n        var defaultState = {};\r\n        serviceKeys.forEach(function (key) {\r\n            if (key !== 'default') {\r\n                defaultState[key] = Service[key].defaultResult();\r\n            }\r\n        });\r\n        // 动态模块注册\r\n        $store.registerModule(namespace, {\r\n            // 开启命名空间\r\n            namespaced: true,\r\n            // @ts-ignore\r\n            state: function () { return (__assign(__assign({}, defaultState), ((module_1 || {}).state || {}))); },\r\n            mutations: __assign({ receive: function (state, payload) {\r\n                    var keys = Object.keys(state);\r\n                    // eslint-disable-next-line @typescript-eslint/no-shadow\r\n                    for (var i_1 = 0; i_1 < keys.length; i_1++) {\r\n                        var key = keys[i_1];\r\n                        // eslint-disable-next-line no-param-reassign\r\n                        state[key] = payload[key];\r\n                    }\r\n                } }, ((module_1 || {}).mutations || {})),\r\n            getters: __assign({}, ((module_1 || {}).getters || {})),\r\n            actions: __assign(__assign({}, createActions({ namespace: namespace, service: Service, serviceKeys: serviceKeys })), ((module_1 || {}).actions || {})),\r\n        });\r\n    };\r\n    for (var i = 0; i < namespaces.length; i++) {\r\n        _loop_3(i);\r\n    }\r\n}\r\n/**\r\n * formatKey 转换第一个字符为大写\r\n * @param key\r\n * @return string\r\n */\r\nfunction formatKey(key) {\r\n    var firstChart = key.charAt(0);\r\n    return \"\" + firstChart.toUpperCase() + key.substring(1);\r\n}\r\n/**\r\n * plugin\r\n * @param serviceConfig - service的配置\r\n * @param modules - 模块的配置\r\n * @return Function\r\n */\r\nvar plugin = function (serviceConfig, modules) {\r\n    console.log('~~~~~~~~~~~~~~~~~~~~~~~~plugin的构造函数');\r\n    $serviceConfig = serviceConfig;\r\n    $modules = modules;\r\n    console.log('~~~~~~~~~~~~~~~~~~~~~~~~plugin的构造函数1', $serviceConfig);\r\n    console.log('~~~~~~~~~~~~~~~~~~~~~~~~plugin的构造函数2', $modules);\r\n    /**\r\n     * vuex的一个VuexGenerator插件\r\n     * @param context\r\n     */\r\n    // @ts-ignore\r\n    return function (store) {\r\n        // 获取vuex的store对象\r\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n        $store = store;\r\n        // 创建loading的module\r\n        registerLoading();\r\n        // 根据serviceConfig配置自动生成module配置\r\n        registerBusinessModules();\r\n    };\r\n};\r\n/**\r\n * mapState\r\n * @param namespaces\r\n * @return object\r\n */\r\nexports.mapState = function (namespaces) {\r\n    console.log('mapState', namespaces);\r\n    var states = {\r\n        loading: function (state) { return state.loading; },\r\n    };\r\n    var _loop_4 = function (i) {\r\n        var namespace = namespaces[i];\r\n        // service的实例\r\n        var Service = $serviceConfig[namespace];\r\n        var serviceKeys = Object.keys(Service);\r\n        var _loop_5 = function (j) {\r\n            var key = serviceKeys[j];\r\n            // eslint-disable-next-line no-continue\r\n            if (key === 'default')\r\n                return \"continue\";\r\n            states[\"\" + namespace + formatKey(key)] = function (state) { return state[namespace][key]; };\r\n        };\r\n        for (var j = 0; j < serviceKeys.length; j++) {\r\n            _loop_5(j);\r\n        }\r\n    };\r\n    for (var i = 0; i < namespaces.length; i++) {\r\n        _loop_4(i);\r\n    }\r\n    return vuex_1.mapState(states);\r\n};\r\n/**\r\n * mapActions\r\n * @param namespaces\r\n * @return object\r\n */\r\nexports.mapActions = function (namespaces) {\r\n    var actions = {};\r\n    for (var i = 0; i < namespaces.length; i++) {\r\n        var namespace = namespaces[i];\r\n        // service的实例\r\n        var Service = $serviceConfig[namespace];\r\n        var serviceKeys = Object.keys(Service);\r\n        for (var j = 0; j < serviceKeys.length; j++) {\r\n            var key = serviceKeys[j];\r\n            // eslint-disable-next-line no-continue\r\n            if (key === 'default')\r\n                continue;\r\n            actions[\"\" + namespace + formatKey(key) + \"Action\"] = namespace + \"/\" + key;\r\n        }\r\n    }\r\n    return vuex_1.mapActions(actions);\r\n};\r\n/**\r\n * mapMutations\r\n * @param namespaces\r\n * @return object\r\n */\r\nexports.mapMutations = function (namespaces) {\r\n    var mutations = {};\r\n    for (var i = 0; i < namespaces.length; i++) {\r\n        var namespace = namespaces[i];\r\n        mutations[namespace + \"ReceiveMutation\"] = namespace + \"/receive\";\r\n    }\r\n    return vuex_1.mapMutations(mutations);\r\n};\r\n/**\r\n * cleanMixin - 在组件销毁之前重置所用的namespace的数据流为初始化数据\r\n * @param namespaces\r\n * @return function\r\n */\r\nexports.cleanMixin = function (namespaces) {\r\n    return {\r\n        /**\r\n         * beforeDestroy - 重置namespaces数据流的数据\r\n         */\r\n        beforeDestroy: function () {\r\n            var _this = this;\r\n            namespaces.forEach(function (namespace) {\r\n                var Service = $serviceConfig[namespace];\r\n                var serviceKeys = Object.keys(Service);\r\n                var defaultState = {};\r\n                serviceKeys.forEach(function (key) {\r\n                    if (key !== 'default') {\r\n                        defaultState[key] = Service[key].defaultResult();\r\n                    }\r\n                });\r\n                // @ts-ignore\r\n                _this.$store.commit(namespace + \"/receive\", defaultState);\r\n            });\r\n        },\r\n    };\r\n};\r\nexports.default = plugin;\r\n"],"names":["$store","$serviceConfig","$modules","__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","vuex_1","defineProperty","exports","value","cleanMixin","mapMutations","mapActions","mapState","require","createActions","_a","namespace","service","serviceKeys","actions","key","params","commit","state","Promise","resolve","reject","root","then","response","_b","default","codeKey","codeSuccessKey","dataKey","catch","_loop_1","registerLoading","_state","global","namespaces","keys","Service","forEach","_loop_2","registerModule","namespaced","mutations","receive","others","globalLoading","props","registerBusinessModules","module_1","defaultState","defaultResult","payload","i_1","getters","_loop_3","formatKey","charAt","toUpperCase","substring","plugin","serviceConfig","modules","console","log","store","states","loading","_loop_4","j","_loop_5","beforeDestroy","_this"],"mappings":"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"}